<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>端口映射 • ZHA-idea</title><meta name="description" content="端口映射 - ahz-r3verse"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="ZHA-idea"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="ZHA-idea" type="application/atom+xml">
</head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="ZHA-idea"><img class="logo-image" src="/logo.svg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">端口映射</h1><div class="post-info"><a></a>2021-04-12</div><div class="post-content"><h1 id="DAY1-端口映射"><a href="#DAY1-端口映射" class="headerlink" title="DAY1:端口映射"></a>DAY1:端口映射</h1><h3 id="0x01-TCP-IP协议"><a href="#0x01-TCP-IP协议" class="headerlink" title="0x01 TCP/IP协议"></a>0x01 TCP/IP协议</h3><p>网络分为5层，从上到下分别为<strong>应用层</strong>、<strong>运输层</strong>、<strong>网络层</strong>、<strong>链路层</strong>和物理层，</p>
<p>上层需要下层服务的支持。在软件层面上，我们主要研究前四层而不考虑信息在物理层上如何传输。</p>
<p>应用通过API将信息丢给应用层，然后依次传输到下层，直到物理层以二进制的方式传输，到达目的地后再由下层向上层传输，回到应用层去。我们主要研究信息在软件层面（前4层）的传输，而不考虑在物理层如何传输。</p>
<p>以QQ程序为例，computer A 发送的消息要经过4层处理，每经过一层，该层就会对你的信息进行包装。包装的大致方式是在原有信息上添加报文首部（header）补充信息，就像写完一封信要在信封上添加发件人、收件人信息一样。其中应用层会添加端口信息（port）；传输层添加TCP/UDP信息；网络层添加IP地址信息（包括源端口和目的端口）；链路层添加MAC信息。同样地，computer B 收到报文后，相应的层会自下而上对报文进行解析，找到对应的 MAC 、IP 、port，然后找到目标电脑和目标程序，对方就能收到你的信息了。</p>
<p><img src="/DAY1%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png" alt="未命名文件"></p>
<p>但在现实中，两台电脑并不能直接传输信息。信息需要经由路由器、交换机的转发处理，才能到达目的电脑。<img src="/DAY1%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B61.png" alt="未命名文件1"></p>
<p>路由器通过解析目的IP，对信息进行转发,</p>
<p>其中路由器的网络协议中只有网络层、链路层和物理层，交换机只有链路层和物理层。这意味着路由器只能将信息解析到 IP 的程度，不过这足够路由器对信息进行转发了。</p>
<h3 id="0x02-外网IP和内网IP"><a href="#0x02-外网IP和内网IP" class="headerlink" title="0x02 外网IP和内网IP"></a>0x02 外网IP和内网IP</h3><h4 id="外网和内网："><a href="#外网和内网：" class="headerlink" title="外网和内网："></a>外网和内网：</h4><p>简单来说，路由器外属于公网，而路由器内就是内网。</p>
<p>由于ipv4协议的ip地址有限，不能满足给每一台电脑分配单独的IP的需求。于是便有了公网IP和内网IP，同样地存在内外网端口。</p>
<p><code>NAT端口映射</code>实现了<strong>外网端口和内网端口之间的映射</strong>，把外网端口和内网端口进行对应。<img src="/DAY1%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B62.png" alt="未命名文件2"></p>
<p><strong>做过NAT端口映射后，公网端口就确定了，就可以通过公网连接工作室机子瞭！</strong></p>
<h3 id="0x03-实践："><a href="#0x03-实践：" class="headerlink" title="0x03 实践："></a>0x03 实践：</h3><h4 id="TODO：从工作室外ssh到node01，执行ifconfig、arp命令。"><a href="#TODO：从工作室外ssh到node01，执行ifconfig、arp命令。" class="headerlink" title="TODO：从工作室外ssh到node01，执行ifconfig、arp命令。"></a>TODO：从工作室外ssh到node01，执行ifconfig、arp命令。</h4><p>已知机子公网 IP:Port 为 202.115.13.201:12222 ,执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp</span><br></pre></td></tr></table></figure>



</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2021/04/12/Mysql-JDBC-noob/">prev</a></div><div class="copyright"><p>&copy; 2021 <a href="http://example.com">ahz-r3verse</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>