<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>Mysql & JDBC noob • ZHA-idea</title><meta name="description" content="Mysql &amp; JDBC noob - ahz-r3verse"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="ZHA-idea"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="ZHA-idea" type="application/atom+xml">
</head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="ZHA-idea"><img class="logo-image" src="/logo.svg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Mysql & JDBC noob</h1><div class="post-info"><a></a>2021-04-12</div><div class="post-content"><h1 id="学习MySql数据库-和-JDBC"><a href="#学习MySql数据库-和-JDBC" class="headerlink" title="学习MySql数据库 和 JDBC"></a>学习MySql数据库 和 JDBC</h1><h2 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h2><h3 id="一、终端登录数据库"><a href="#一、终端登录数据库" class="headerlink" title="一、终端登录数据库"></a>一、终端登录数据库</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vt411z7wy">一天学会mysql</a></p>
<p>配置环境变量略</p>
<h4 id="SQL语法"><a href="#SQL语法" class="headerlink" title="SQL语法"></a>SQL语法</h4><p><strong>登陆：<code>&gt;mysql -uroot -p********</code></strong></p>
<blockquote>
<p>-u是usr的意思，-p是psw</p>
</blockquote>
<p><strong>查询：<code>mysql&gt; show databases;</code> <code>mysql&gt; show tables;</code></strong></p>
<p><strong>选中/查询：<code>use xxx</code> <code>mysql&gt; select * from admin</code></strong></p>
<p>退出：<code>mysql&gt; exit</code></p>
<p><strong>创建数据库：<code>mysql&gt; create database xxx </code></strong> ``</p>
<p><strong>创建数据表(example)：<code>CREATE TABLE pet(name VARCHAR(20),owner VARCHAR(20),sex CHAR(1),birth DATE, death DATE); </code></strong></p>
<p>​        <strong>描述数据表：<code>describe pet/desc pet;</code></strong></p>
<p>![截屏2021-03-26 上午9.00.29](/Users/boxizhou/Desktop/md/img/截屏2021-03-26 上午9.00.29.png)</p>
<p><strong>添加数据：<code>INSERT INTO pet</code> <code>VALUES(&#39;Puffball&#39;,&#39;Diane&#39;,&#39;f&#39;,&#39;1999-03-30&#39;,NULL)</code></strong></p>
<p>![截屏2021-03-26 上午9.07.26](/Users/boxizhou/Desktop/md/img/截屏2021-03-26 上午9.07.26.png)</p>
<p><strong>删除数据：<code>delete from pet where name=&#39;Puffball&#39; </code></strong>(两条都被删掉)</p>
<p><strong>修改数据：<code>update pet set name=&#39;Bufferball&#39; where name=&#39;Puffball&#39; </code></strong></p>
<blockquote>
<p>增：INSERT</p>
<p>删：DELETE</p>
<p>改：UPDATE</p>
<p>查：SELECT</p>
</blockquote>
<h4 id="数据类型：（菜鸟文档）"><a href="#数据类型：（菜鸟文档）" class="headerlink" title="数据类型：（菜鸟文档）"></a>数据类型：（<a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-data-types.html">菜鸟文档</a>）</h4><ol>
<li>数值（溢出会报错）</li>
<li>日期/时间</li>
<li>字符串/字符</li>
</ol>
<h4 id="约束类型"><a href="#约束类型" class="headerlink" title="约束类型"></a>约束类型</h4><ol>
<li><p>主件约束</p>
</li>
<li><p>自增约束</p>
</li>
<li><p>唯一约束</p>
</li>
<li><p>非空约束</p>
</li>
<li><p>默认约束</p>
</li>
<li><p><strong>外键约束</strong></p>
</li>
</ol>
<blockquote>
<p>添加约束</p>
<ol>
<li>建表的时候添加约束</li>
<li>alter 。。。 add 。。。添加约束</li>
<li>alter。。。modify。。。</li>
</ol>
<p>删除约束</p>
<p>alter 。。。 drop。。。</p>
</blockquote>
<h5 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h5><p>– 涉及到两个表：主表，副表</p>
<p><em><strong>e.g.</strong></em></p>
<p>主表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table classes(</span><br><span class="line">    id int primary key,</span><br><span class="line">    name varchar(20)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>副表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table student(</span><br><span class="line">    id int primary key,</span><br><span class="line">  name varchar(20),</span><br><span class="line">  class_id int,</span><br><span class="line">  foreign key(class_id) references classes(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>⬆️student 表里的 class_id 必须来自于 classes 表中的 id 字段</p>
<blockquote>
<p>1 主表 classes 中没有的数据值 ID ，在副表 student 中 class_id 是不可以使用的</p>
<p>![](/Users/boxizhou/Desktop/md/img/截屏2021-03-27 下午3.30.27.png)</p>
<p>2 主表中的记录被副表引用，是不可以被删除的</p>
<p>![](/Users/boxizhou/Desktop/md/img/截屏2021-03-27 下午3.29.24.png)</p>
</blockquote>
<h4 id="数据表设计范式"><a href="#数据表设计范式" class="headerlink" title="数据表设计范式"></a>数据表设计范式</h4><h5 id="第一范式-1NF"><a href="#第一范式-1NF" class="headerlink" title="第一范式 1NF"></a>第一范式 1NF</h5><p>字段尽量拆分，数据原子化储存</p>
<h5 id="第二范式-2NF"><a href="#第二范式-2NF" class="headerlink" title="第二范式 2NF"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vt411z7wy?p=17&spm_id_from=pageDriver">第二范式 2NF</a></h5><p>满足 1NF 前提下，要求除了主建外每一列都必须完全依赖于主键</p>
<h5 id="第三范式-3NF"><a href="#第三范式-3NF" class="headerlink" title="第三范式 3NF"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vt411z7wy?p=18&spm_id_from=pageDriver">第三范式 3NF</a></h5><p>满足第二范式前提下，除主建外其他列不能有传递依赖关系</p>
<h4 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h4><p><em>典中典：</em><code>select * from xxx</code>;</p>
<p><em>查询特定字段</em> <code>select sno,cno,degree from student</code></p>
<p><em>排除重复字段 distinct</em> <code>select distinct * from student</code></p>
<p><em>区间查询 where …between ..and ..</em> <code>select * from score where degree between 60 and 80</code></p>
<p>​                                                    <code>select * from score where degree &gt; 60 and degree &lt; 80</code></p>
<p><em>“in或者“关系查询 in</em><code>select * from score where degree in(85,86,88)</code>(查询score表中成绩为85 86 88的记录)</p>
<p><em>“or或者”关系查询 or：</em><code>select * from student where class=&#39;95031&#39; or ssex=&#39;女&#39;</code>;（查询 班级是95031 或者 性别是女 的记录）</p>
<p><em>升序 asc、降序 desc|order by xxx asc/desc：</em><code>select * from student order by clss desc</code> ;</p>
<p><em>统计个数 count（）：</em><code>select count(*) from student where class=&#39;95031&#39;</code>;</p>
<h3 id="二、JDBC-Java-DataBase-Connectivity"><a href="#二、JDBC-Java-DataBase-Connectivity" class="headerlink" title="二、JDBC ( Java DataBase Connectivity)"></a>二、JDBC ( Java DataBase Connectivity)</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1eJ411c7rf"><del>电子科技大学</del>❌尚硅谷大学✅</a></p>
<p><img src="/Users/boxizhou/Desktop/md/img/JDBC%E6%8A%BD%E8%B1%A1.png" alt="JDBC抽象"></p>
<h4 id="一、测试数据库连接"><a href="#一、测试数据库连接" class="headerlink" title="一、测试数据库连接"></a>一、测试数据库连接</h4><p><strong>方式一：一步步来</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-data-types.html">properties类</a></p>
<blockquote>
<p>关于url：</p>
<p>jdbc:mysql是协议类型</p>
<p>3306是mysql端口号</p>
<p>test指其中的名为 test 的数据库</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectionTest1</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">                <span class="comment">//1. 获取driver的实现类对象</span></span><br><span class="line">        Driver driver = <span class="keyword">new</span> com.mysql.jdbc.Driver();</span><br><span class="line">                <span class="comment">//2. 连接路径</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">          <span class="comment">//3. 这个properties用于封装用户名和密码</span></span><br><span class="line">        Properties info = <span class="keyword">new</span> Properties();</span><br><span class="line">          info.setProperty(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        info.setProperty(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;ZHOUboxi&quot;</span>);</span><br><span class="line">                <span class="comment">//4. 点火起飞</span></span><br><span class="line">        Connection conn = driver.connect(url,info);</span><br><span class="line"></span><br><span class="line">          System.out.println(conn);</span><br><span class="line">    &#125;    </span><br></pre></td></tr></table></figure>

<p>![截屏2021-03-27 下午8.19.08](/Users/boxizhou/Desktop/md/img/截屏2021-03-27 下午8.19.08.png)</p>
<p><strong>拿到了数据库，操作成功！</strong></p>
<p>另外那一串红色的提示说com.mysql.jdbc.Driver不推荐使用，最新的是com.mysql.chj.Driver</p>
<p><strong>方式二：反射</strong>  增加了可移植性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectionTest2</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException, IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">        <span class="comment">//1。获取Driver的实现类对象</span></span><br><span class="line">        Class clazz = Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        Driver driver = (Driver)clazz.newInstance();</span><br><span class="line">        <span class="comment">//2.提供数据库地址</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        <span class="comment">//3.提供用户名密码</span></span><br><span class="line">        Properties info = <span class="keyword">new</span> Properties();</span><br><span class="line">        info.setProperty(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        info.setProperty(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;ZHOUboxi&quot;</span>);</span><br><span class="line">        <span class="comment">//4.获取连接</span></span><br><span class="line">        Connection conn = driver.connect(url,info);</span><br><span class="line"></span><br><span class="line">        System.out.println(conn);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>方式三：使用DriverManager替换Driver</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectionTest3</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException, IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">        <span class="comment">//1.注册驱动</span></span><br><span class="line">        Class clazz = Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        Driver driver = (Driver)clazz.newInstance();</span><br><span class="line">        <span class="comment">//2.提供三个基本信息</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String pswd = <span class="string">&quot;ZHOUboxi&quot;</span>;</span><br><span class="line">        <span class="comment">//3.注册驱动管理</span></span><br><span class="line">        DriverManager.registerDriver(driver);</span><br><span class="line">        <span class="comment">//4.获取连接</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(url,user,pswd);</span><br><span class="line"></span><br><span class="line">        System.out.println(conn);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>方式四：优化</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectionTest4</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException, IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">        <span class="comment">//1.加载驱动</span></span><br><span class="line"><span class="comment">/*        Class clazz = **/</span> Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"><span class="comment">//        Driver driver = (Driver)clazz.newInstance();</span></span><br><span class="line">        <span class="comment">//2.提供三个基本信息</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String pswd = <span class="string">&quot;ZHOUboxi&quot;</span>;</span><br><span class="line"><span class="comment">//        //3.注册驱动管理</span></span><br><span class="line"><span class="comment">//        DriverManager.registerDriver(driver);</span></span><br><span class="line">        <span class="comment">//4.获取连接</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(url,user,pswd);</span><br><span class="line"></span><br><span class="line">        System.out.println(conn);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>和三相比，没有去注册driver，因为在加载“com.mysql.jdbc.Driver”类的时候，自动加载了Driver</p>
<p>Driver实现类代码如下：</p>
<p>![截屏2021-03-27 下午9.18.13](/Users/boxizhou/Desktop/md/img/截屏2021-03-27 下午9.18.13.png)</p>
<p>看看这个static代码块，<strong>随着类的加载而加载</strong></p>
<p><strong>方式五：最终版本，使用配置文件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//todo：把4个基本信息放在配置文件中，读取配置文件获取连接</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectionTest5</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//1。读取配置文件信息</span></span><br><span class="line">        InputStream is = ConnectionTest.class.getClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Properties pros = <span class="keyword">new</span> Properties();</span><br><span class="line">        pros.load(is);</span><br><span class="line"></span><br><span class="line">        String user = pros.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        String password = pros.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String url = pros.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        String driverClass = pros.getProperty(<span class="string">&quot;driverClass&quot;</span>);</span><br><span class="line">        <span class="comment">//2.加载驱动</span></span><br><span class="line">        Class.forName(driverClass);</span><br><span class="line">        <span class="comment">//3.获取连接</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(url,user,password);</span><br><span class="line"></span><br><span class="line">        System.out.println(conn);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>配置文件：jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取4个基本信息</span></span><br><span class="line"><span class="attr">user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">ZHOUboxi</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/test</span></span><br><span class="line"><span class="attr">driverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>好就好在把代码无关的配置<strong>解耦合</strong>了，以后修改时不需要重新打包</p>
<h4 id="二、PreparedStatement对数据库进行CRUD操作"><a href="#二、PreparedStatement对数据库进行CRUD操作" class="headerlink" title="二、PreparedStatement对数据库进行CRUD操作"></a>二、PreparedStatement对数据库进行CRUD操作</h4><h6 id="三体文明发来信息：不要用Statement！不要用Statement！！不要用Statement！！！"><a href="#三体文明发来信息：不要用Statement！不要用Statement！！不要用Statement！！！" class="headerlink" title="三体文明发来信息：不要用Statement！不要用Statement！！不要用Statement！！！"></a>三体文明发来信息：不要用Statement！不要用Statement！！不要用Statement！！！</h6><p>因为可能会出现sql注入问题，<strong>使用更先进的，有预编译功能的PreparedStatement</strong></p>
<p>statement翻译为“信使”</p>
<p>实际上一个数据库连接就是一个<strong>Socket</strong>连接</p>
<p>为了方便已经把connection操作和最后的资源回收操作封装在JDBCutils类中</p>
<p><strong>INSERT</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//todo:增加一条数据</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">//1.建立连接</span></span><br><span class="line">            conn = JDBCutils.getConnection();</span><br><span class="line">            <span class="comment">//2.预编译sql语句，返回PreparedStatement实例</span></span><br><span class="line">            String sql = <span class="string">&quot;insert into user_table(user,password) values(?,?)&quot;</span>;<span class="comment">// 其中&quot;?&quot;是占位符</span></span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//3.填充占位符</span></span><br><span class="line">            ps.setString(<span class="number">1</span>, <span class="string">&quot;耐克&quot;</span>);</span><br><span class="line">            ps.setString(<span class="number">2</span>,<span class="string">&quot;gaisi&quot;</span>);</span><br><span class="line">            <span class="comment">//4.执行sql操作</span></span><br><span class="line">            ps.execute();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="comment">//5.关闭Statement和连接</span></span><br><span class="line">            JDBCutils.closeResuorses(conn,ps);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>DELETE、UPDATE</strong>操作类似不再赘述</p>
<p>下面把增删改放在一起实现</p>
<blockquote>
<p>JAVA可变形参的使用：<code>数据类型 ...形参名</code></p>
<p>只要在形参的数据类型与参数名之间加上三个“.”，就可以让他和个数不确定的实参想匹配。不过有一点需要注意，每个方法<em><strong>只能有一个</strong></em>这样的参数个数可变的形参，且这个形参<em><strong>必须是形参列表的最后一个</strong></em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAgrs</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       TestAgrs t = <span class="keyword">new</span> TestAgrs();</span><br><span class="line">       t.sayHello1(<span class="string">&quot;g&quot;</span>,<span class="string">&quot;f&quot;</span>,<span class="string">&quot;fg&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//如下三个方法构成重载</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;hello  word&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;hello&quot;</span> + str);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello1</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">           System.out.println(args[i]);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">           System.out.println(args[i]);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;g</span><br><span class="line">&gt;f</span><br><span class="line">&gt;fg</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>增删改 UPDATE 针对于user_table的通用化操作</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//todo：通用的增删改操作</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String sql, Object ...args)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.获取连接</span></span><br><span class="line">            conn = JDBCutils.getConnection();</span><br><span class="line">            <span class="comment">//2.预编译sql语句，返回PreparedStatement实例</span></span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//3.填充占位符</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length;i++)&#123;</span><br><span class="line">                ps.setObject(i+<span class="number">1</span>,args[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//4.执行sql操作</span></span><br><span class="line">            ps.execute();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//5.关闭Statement和Connection</span></span><br><span class="line">            JDBCutils.closeResuorses(conn,ps);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>SELECT</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//todo:查询操作</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.获取连接</span></span><br><span class="line">            conn = JDBCutils.getConnection();</span><br><span class="line">            <span class="comment">//2.预编译sql语句，返回PreparedStatement实例</span></span><br><span class="line">            String sql = <span class="string">&quot;select * from user where user=?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//3.填充占位符</span></span><br><span class="line">            ps.setObject(<span class="number">1</span>,<span class="string">&quot;ZHA&quot;</span>);</span><br><span class="line">            <span class="comment">//4.执行sql操作,并且返回结果集</span></span><br><span class="line">            ResultSet resultSet = ps.executeQuery();</span><br><span class="line">            <span class="comment">//5.处理结果集</span></span><br><span class="line">            <span class="keyword">if</span>(resultSet.next())&#123;<span class="comment">//判断结果集下一条是否有数据，如果有，获取字段值</span></span><br><span class="line">                <span class="keyword">int</span> id = resultSet.getInt(<span class="number">1</span>);</span><br><span class="line">                String user = resultSet.getString(<span class="number">2</span>);</span><br><span class="line">                String password = resultSet.getString(<span class="number">3</span>);</span><br><span class="line"><span class="comment">//                System.out.println(&quot;id=&quot;+id+&quot;,user=&quot;+user+&quot;,password=&quot;+password);</span></span><br><span class="line">                User user1 = <span class="keyword">new</span> User(id,user,password);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.关闭Statement和Connection</span></span><br><span class="line">            JDBCutils.closeResuorses(conn,ps);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>ORM编程思想</strong></p>
<p>一个表对应一个Java类</p>
<p>表中的一条记录对应一个对象</p>
<p>一个字段对应一个属性</p>
<p><img src="/Users/boxizhou/Desktop/md/img/Java%E5%92%8Csql%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%AF%B9%E5%BA%94%E8%A1%A8.png" alt="Java和sql数据类型对应表"></p>
</blockquote>
<p><strong>SELECT 针对于user_table表的通用化操作</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//todo:查询操作通用化</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCommonSelect</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select * from user_table where user=?&quot;</span>;</span><br><span class="line">        User myUser = commonSelect(sql,<span class="string">&quot;ZHA&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;id=&quot;</span>+myUser.getId()+<span class="string">&quot;,user=&quot;</span>+myUser.getUser()+<span class="string">&quot;,password=&quot;</span>+myUser.getPassword());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">commonSelect</span><span class="params">(String sql,Object ...args)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.获取连接</span></span><br><span class="line">            conn = JDBCutils.getConnection();</span><br><span class="line">            <span class="comment">//2.预编译sql语句，返回PreparedStatement实例</span></span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//3.填充占位符</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; args.length; i++)&#123;</span><br><span class="line">                ps.setObject(i+<span class="number">1</span>,args[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//4.执行sql操作,并且返回结果集</span></span><br><span class="line">            resultSet = ps.executeQuery();</span><br><span class="line">            <span class="comment">//5.处理结果集</span></span><br><span class="line">                <span class="comment">//获取结果集的元数据(metaData,元数据，即&quot;修饰数据的数据&quot;</span></span><br><span class="line">            ResultSetMetaData metaData = resultSet.getMetaData();</span><br><span class="line">                <span class="comment">//通过metaData获取结果集列数（字段数）</span></span><br><span class="line">            <span class="keyword">int</span> columnCount = metaData.getColumnCount();</span><br><span class="line">            <span class="keyword">if</span>(resultSet.next())&#123;<span class="comment">//判断结果集下一条是否有数据，如果有，获取字段值</span></span><br><span class="line"></span><br><span class="line">                User user2 = <span class="keyword">new</span> User();</span><br><span class="line">                <span class="comment">//处理一行结果集中的每一列</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnCount; i++)&#123;</span><br><span class="line">                    Object columnValue = resultSet.getObject(i + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//获取每一列的列名（字段名）</span></span><br><span class="line">                    String columnName = metaData.getColumnName(i + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//todo:难点。给user对象对应字段的属性赋值（通过反射***</span></span><br><span class="line">                    Field field = User.class.getDeclaredField(columnName);</span><br><span class="line">                    field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    field.set(user2,columnValue);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> user2;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.关闭Statement和Connection</span></span><br><span class="line">            JDBCutils.closeResuorses(conn,ps,resultSet);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 NoSuchFeildException ，即数据库中列名和 JavaBean 不一样</p>
<p>![截屏2021-03-31 下午10.19.22](/Users/boxizhou/Desktop/md/img/截屏2021-03-31 下午10.19.22.png)</p>
<p>此时可以<strong>在结果集中给列取别名</strong></p>
<p>举个例子：</p>
<p>数据库中列名为<code>order_id</code>,但是Java类属性是<code>orderId</code>,直接反射会报错。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_id orderId,order_name oderName, order_date orderDate</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">&#x27;order&#x27;</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>order表中列名本来是 “<code>order_id</code>”,但是返回的结果集中字段却为 “<code>orderId</code>”</p>
<p><strong>不过还没结束</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取每一列的列名（字段名）</span></span><br><span class="line">                    String columnName = metaData.getColumnName(i + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>这一条代码是<em>直接从数据库中读列名</em>，我们<strong>要获取列的“别名”</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取每一列的列名（字段名）</span></span><br><span class="line">                    String columnName = metaData.getColumnLable(i + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><code>getColumnLable()</code>可以从结果集中获取列的别名,没有别名时就是原名。</p>
</blockquote>
<p><strong>小结</strong></p>
<p>![截屏2021-03-31 下午10.32.56](/Users/boxizhou/Desktop/md/img/截屏2021-03-31 下午10.32.56.png)</p>
<p><strong>SELECT针对不同表的通用查询操作</strong></p>
<h6 id="大的要来了"><a href="#大的要来了" class="headerlink" title="大的要来了"></a>大的要来了</h6><p>针对所有表的通用化主要就是类的反射、泛型使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 针对所有表的通用化主要就是类的反射、泛型使用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//todo:查询操作针对不同表的通用化</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCommonSelect</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select id,user,password from user_table where id&gt;?&quot;</span>;</span><br><span class="line">        ArrayList&lt;User&gt; users = commonSelect(User.class,sql,<span class="number">1</span>);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">ArrayList&lt;T&gt; <span class="title">commonSelect</span><span class="params">(Class&lt;T&gt; clazz, String sql, Object...args)</span></span>&#123;<span class="comment">//泛型参数</span></span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.获取连接</span></span><br><span class="line">            conn = JDBCutils.getConnection();</span><br><span class="line">            <span class="comment">//2.预编译sql语句，返回PreparedStatement实例</span></span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//3.填充占位符</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; args.length; i++)&#123;</span><br><span class="line">                ps.setObject(i+<span class="number">1</span>,args[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//4.执行sql操作,并且返回结果集</span></span><br><span class="line">            resultSet = ps.executeQuery();</span><br><span class="line">            <span class="comment">//5.处理结果集</span></span><br><span class="line">            <span class="comment">//获取结果集的元数据(metaData,元数据，即&quot;修饰数据的数据&quot;</span></span><br><span class="line">            ResultSetMetaData metaData = resultSet.getMetaData();</span><br><span class="line">            <span class="comment">//通过metaData获取结果集列数（字段数）</span></span><br><span class="line">            <span class="keyword">int</span> columnCount = metaData.getColumnCount();</span><br><span class="line">              <span class="comment">//创建ArrayList存储对象</span></span><br><span class="line">            ArrayList&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">            <span class="keyword">while</span>(resultSet.next())&#123;<span class="comment">//判断结果集下一条是否有数据，如果有，获取字段值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//                User user2 = new User();</span></span><br><span class="line">                T t = clazz.newInstance();</span><br><span class="line">                <span class="comment">//处理一行结果集中的每一列</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnCount; i++)&#123;</span><br><span class="line">                    <span class="comment">//获取这一列的内容</span></span><br><span class="line">                    Object columnValue = resultSet.getObject(i + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//获取每一列的列名（字段名）</span></span><br><span class="line">                    String columnName = metaData.getColumnLabel(i + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//todo:难点。给user对象对应字段的属性赋值（通过反射***</span></span><br><span class="line">                    Field field = User.class.getDeclaredField(columnName);</span><br><span class="line">                    field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    field.set(t,columnValue);</span><br><span class="line">                &#125;</span><br><span class="line">                list.add(t);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.关闭Statement和Connection</span></span><br><span class="line">            JDBCutils.closeResuorses(conn,ps,resultSet);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><ul>
<li>两种思想<ul>
<li>面向接口编程</li>
<li>ORM思想<ul>
<li>一个数据表对应一个Java类</li>
<li>一条记录对应一个Java对象</li>
<li>一个字段对应Java类的一个属性</li>
</ul>
</li>
</ul>
</li>
<li>两种技术<ul>
<li>JDBC结果集元数据<ul>
<li>获取列数：<code>getColumnCount()</code></li>
<li>获取列的别名<code>getColumnLable()</code></li>
</ul>
</li>
<li><strong>反射</strong>：创建指定类的对象，给对象的属性进行查改</li>
</ul>
</li>
</ul>
<h4 id="三、PreparedStatement操作blob类型数据"><a href="#三、PreparedStatement操作blob类型数据" class="headerlink" title="三、PreparedStatement操作blob类型数据"></a>三、PreparedStatement操作blob类型数据</h4><blockquote>
<p>关于blob类型</p>
<p>![截屏2021-04-01 下午7.32.08](/Users/boxizhou/Desktop/md/img/截屏2021-04-01 下午7.32.08.png)</p>
</blockquote>
<p><strong>Blob INSERT</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//todo：INESERT</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">blobInsertTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = JDBCutils.getConnection();</span><br><span class="line">        String sql = <span class="string">&quot;insert into photo_table(id,name,photo) values(?,?,?)&quot;</span>;</span><br><span class="line">        PreparedStatement ps = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        ps.setObject(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        ps.setObject(<span class="number">2</span>,<span class="string">&quot;ZHA&quot;</span>);</span><br><span class="line">        FileInputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;/Users/boxizhou/Desktop/TsetPic.png&quot;</span>));</span><br><span class="line">        ps.setBlob(<span class="number">3</span>,is);</span><br><span class="line"></span><br><span class="line">        ps.execute();</span><br><span class="line"></span><br><span class="line">        JDBCutils.closeResuorses(conn,ps);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><strong>Blob SELECT</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="comment">//todo:SELECT</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">blobSelectTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       Connection conn = <span class="keyword">null</span>;</span><br><span class="line">       PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">       FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line">       InputStream is = <span class="keyword">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           conn = JDBCutils.getConnection();</span><br><span class="line">           String sql = <span class="string">&quot;select id,name,photo from photo_table where id=?&quot;</span>;</span><br><span class="line">           ps = conn.prepareStatement(sql);</span><br><span class="line">           ps.setObject(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">           ResultSet resultSet = ps.executeQuery();</span><br><span class="line">           <span class="keyword">if</span>(resultSet.next())&#123;</span><br><span class="line">               <span class="keyword">int</span> id = resultSet.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">               String name = resultSet.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">               <span class="comment">//将Blob类型文件保存在本地</span></span><br><span class="line">               Blob photo = resultSet.getBlob(<span class="string">&quot;photo&quot;</span>);</span><br><span class="line">               is = photo.getBinaryStream();</span><br><span class="line">               fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;/Users/boxizhou/Desktop/PicFromBlob.png&quot;</span>);</span><br><span class="line">               <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">               <span class="keyword">int</span> len;</span><br><span class="line">              <span class="comment">//循环读流输出到文件</span></span><br><span class="line">               <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                   len = is.read(buffer);</span><br><span class="line">                   fos.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">                   <span class="keyword">if</span>(len &lt; <span class="number">1024</span>)&#123;<span class="comment">//当流不能装满buffer，视为读完</span></span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception throwables) &#123;</span><br><span class="line">           throwables.printStackTrace();</span><br><span class="line">       &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">           is.close();</span><br><span class="line">           fos.close();</span><br><span class="line">           JDBCutils.closeResuorses(conn, ps);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2021/09/16/CSAPP-BombLab/">prev</a><a class="next" href="/2021/04/12/DAY1%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84/">next</a></div><div class="copyright"><p>&copy; 2022 <a href="http://example.com">ahz-r3verse</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>